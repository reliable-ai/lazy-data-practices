# Lazy Data Practices Harm Fairness Research

This repository contains the code and data for the paper [Lazy Data Practices Harm Fairness Research](https://doi.org/10.1145/3630106.3658931) by Jan Simson, Alessandro Fabris and Christoph Kern, published in the proceedings of the *ACM Conference on Fairness, Accountability, and Transparency 2024* in Rio de Janeiro, Brazil in June 2024.

## Structure

This repository is structured based on the different analyses in the paper. All figures and numbers reported in the paper are generated in the interactive Quarto notebooks, which are located in the folder `notebooks/`. There are two more complicated analyses regarding the influence of data practices on algorithmic performance and fairness. These two analyses can be found under `analyses/`.

Analysis notebooks in the `notebooks/` folder are named according to the section of the paper they correspond to, including the section number. Supporting figures in the appendices A and C are generated in the respective main sections that mention in the paper. The directory also contains a convenience script `render_all_notebooks.R`, which will execute and render all notebooks.

All base versions of figures are generated by the R code within the `notebooks/` folder, with the exception of the nested pie chart in Figure 2 and the Sankey diagram in Figure 4. Both base graphs were generated with [rawgraphs](https://app.rawgraphs.io/) using data exported from notebooks. Figures 2, 4 and 5 were then further edited using Affinity Designer version 1.10.1. Source files for the three figures are located in the `figures/` folder in various formats.

The `R/` directory contains supporting code for the notebook analyses.

## Analyses

### Notebooks

The main analysis notebooks in the `notebooks/` folder are written in Quarto, a literate programming environment. Analyses with the notebooks are written in the R programming language and are designed to be reproducible.

The analyses were conducted using R version 4.2.2 and notebooks were rendered using Quarto version 1.4.549. The `renv` package is used to manage the R environment and dependencies. To install the necessary requirements, install the R package `renv` and run `renv::restore()`.

With all requirements installed, you can run the following command to re-run and render all notebooks:

```r
source("notebooks/render_all_notebooks.R")
```

### Impact of Preprocessing

The paper includes two analyses on the impact of different preprocessing choices on algorithmic performance and fairness. The first analysis explores how the models fitted by the popular AutoML library AutoGluon are affected by different preprocessing choices. The second analysis investigates the impact of preprocessing choices on different fairness-aware and non-fairness-aware algorithms by replicating the analysis of [Friedler et al. (2019)](https://doi.org/10.1145/3287560.3287589).

Please refer to the separate `README` files in the two subfolders of `analyses/` for more information on how to set up the correct Python environments and run the analyses. Both analyses generate CSV files containing their results which are further analyzed and used to generate figures in the notebook `5_opaque_preprocessing.qmd`.

Friedler, S. A., Scheidegger, C., Venkatasubramanian, S., Choudhary, S., Hamilton, E. P., & Roth, D. (2019). A comparative study of fairness-enhancing interventions in machine learning. Proceedings of the Conference on Fairness, Accountability, and Transparency, 329â€“338. https://doi.org/10.1145/3287560.3287589

## Hardware

Analyses were run on a 2021 Macbook Pro running macOS Sonoma with an Apple M1 Pro chip and 16 GB of RAM. Due to lack of parallelization, parts of the reproduction of Friedler et al. (2019) were run on a local server running NixOS 24.05 (Uakari) with 94 Gi of RAM and a Intel(R) Xeon(R) CPU E5-2650 v2 @ 2.60GHz.

With the exception of the reproduction of Friedler et al. (2019), all analyses completed within a few minutes at most and should be able to run on a standard laptop or desktop computer.

## Citing this Project

Simson, J., Fabris, A., & Kern, C. (2022). Lazy Data Practices Harm Fairness Research *(forthcoming)*. Accepted for Publication at the *2024 ACM Conference on Fairness, Accountability, and Transparency (FAccT 2024)*.

## License

All work produced by the authors in this repository is licensed under the [Creative Commons Attribution 4.0 International License](http://creativecommons.org/licenses/by/4.0/). Please note that the authors do not hold the rights to the original datasets (Bank, COMPAS) used in this project, for which other licenses may apply. The analysis code for the reproduction of Friedler et al. (2019) is based on the [original code](https://github.com/algofairness/fairness-comparison) provided by the authors and licensed under the Apache License.

## Acknowledgements

This project was funded by the Federal Ministry of Education and Research. The responsibility for the content of this publication lies with the authors.
